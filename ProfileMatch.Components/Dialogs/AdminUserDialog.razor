@if (EditedUser == null || Departments == null)
{
    <MudProgressLinear Indeterminate="true"></MudProgressLinear>
}
else
{

    <MudDialog>
        <DialogContent>
            <MudForm @ref="Form">
                @if (created)
                {
                    <MudAvatar Image="@EditedUser.PhotoPath">
                    </MudAvatar>
                    <InputFile OnChange="@UploadImage" @ref="inputFile" accept=".jpg, .jpeg, .png" />
                   
                }
                           @if(ShareResource.IsEn()){
                <MudSelect @bind-Value="@EditedUser.DepartmentId"
                           T="int"
                           OffsetY="true"
                           CloseIcon="@Icons.Material.Filled.LocationCity"
                           HelperText=@L["Select Department"]
                           AdornmentColor="Color.Tertiary">
                    @foreach (var dept in Departments)
                    {
                        <MudSelectItem Value="@(dept.Id)">@L[dept.Name]</MudSelectItem>
                    }
                </MudSelect>
                           }else
                           {
                               <MudSelect @bind-Value="@EditedUser.DepartmentId"
                           T="int"
                           OffsetY="true"
                           CloseIcon="@Icons.Material.Filled.LocationCity"
                           HelperText=@L["Select Department"]
                           AdornmentColor="Color.Tertiary">
                    @foreach (var dept in Departments)
                    {
                        <MudSelectItem Value="@(dept.Id)">@L[dept.NamePl]</MudSelectItem>
                    }
                </MudSelect>
                           }
                <MudSwitch @bind-Checked="@EditedUser.IsActive"
                           T="bool"
                           Label=@L["Is Active?"]
                           Color="Color.Success" />
                <MudTextField T="string" @bind-Value="@EditedUser.FirstName" Immediate="true" Label=@L["First Name"]
                              Required="true" RequiredError=@L["Person name is required!"] />
                <MudTextField T="string" @bind-Value="@EditedUser.LastName" Immediate="true" Label=@L["Last Name"] Required="true" RequiredError=@L["Person name is required!"] />
                <MudTextField T="string" Label=@L["Email"] @bind-Value="@EditedUser.Email" Required="true" RequiredError=@L["Email is required!"] />
                @if (ShareResource.IsEn())
                {
                    <MudSelect Required="true" T="int" Label=@L["Select Job Title"] @bind-Value="@EditedUser.JobTitleId"
                OffsetY="true" RequiredError=@L["Job Title is required!"] HelperText=@L["Select Job Title"] AdornmentColor="Color.Tertiary">
                    @foreach(JobTitle job in jobTitles)
                    {
                        <MudSelectItem T="int" Value="@job.Id">@job.Name</MudSelectItem>
                    }
                    </MudSelect>
                }else
                {
                    <MudSelect Required="true" T="JobTitle" Label=@L["Select Job Title"] @bind-Value="@EditedUser.JobTitle"
                OffsetY="true" RequiredError=@L["Job Title is required!"] HelperText=@L["Select Job Title"] AdornmentColor="Color.Tertiary">
                    @foreach(JobTitle job in jobTitles)
                    {
                        <MudSelectItem Value="@job">@job.NamePl]</MudSelectItem>
                    }
                </MudSelect>
                }
                <MudSelect Required="true" T="Gender?" Label=@L["Select Gender"] @bind-Value="@EditedUser.Gender"
                           OffsetY="true" RequiredError=@L["Gender is required!"]
                           CloseIcon="@Icons.Material.Filled.LocationCity"
                           HelperText=@L["Select Gender"]
                           AdornmentColor="Color.Tertiary">
                    @foreach (Gender? g in Enum.GetValues(typeof(Gender)))
                    {
                        <MudSelectItem Value="@g">@L[g.ToString()]</MudSelectItem>
                    }
                </MudSelect>
                <MudDatePicker @bind-Date="@EditedUser.DateOfBirth"
                               Required="true"
                               Rounded="true"
                               Elevation="1"
                               RequiredError=@L["BirthDate is Required"]
                               Label=@L["Select Date of Birth"]
                               Editable="false" />
                               @if(created){
                    <MudTextField T="String" Label="@L["New Password"]" @bind-Value="@PasswordHash"/>
                    <MudButton OnClick="@(()=>ResetPassword(PasswordHash))" >@L["Change Password"]</MudButton>
                }
                @if (canChangeRoles)
                {
                    <MudTable Items="@UserRolesVM">
                        <HeaderContent>
                            <MudTh>@L["Role Name"]</MudTh>
                            <MudTh>@L["Assigned"]</MudTh>
                        </HeaderContent>
                        <RowTemplate>
                            <MudTd DataLabel=@L["Role Name"]>@L[context.RoleName]</MudTd>
                            <MudTd DataLabel=@L["Assigned"]>
                                <MudCheckBox @bind-Checked="@context.IsSelected"/></MudTd>
                        </RowTemplate>
                    </MudTable>
                }
            </MudForm>
          
        </DialogContent>
          <DialogActions>
            <MudButton Size="Size.Small" Color="Color.Warning" Variant="Variant.Outlined" OnClick="Cancel">@L["Cancel"]</MudButton> 
            <MudButton OnClick="@HandleSave" Variant="Variant.Outlined" StartIcon="@Icons.Material.Filled.Save" Color="Color.Success"  Size="Size.Small">@L["Save"]</MudButton>
            </DialogActions>
    </MudDialog>
}
@code{
    private InputFile inputFile;
}